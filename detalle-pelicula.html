<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pel√≠cula - MiStreaming</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/player.css">
</head>
<body>
    <!-- HEADER -->
    <header>
        <nav>
            <div class="logo">üé¨ MiStreaming</div>
            <ul class="nav-links">
                <li><a href="/">Inicio</a></li>
                <li><a href="/peliculas.html">Pel√≠culas</a></li>
                <li><a href="/series.html">Series</a></li>
            </ul>
        </nav>
    </header>

    <!-- DETALLE PEL√çCULA -->
    <div class="detalle-container">
        <div class="backdrop" id="backdrop"></div>
        
        <div class="detalle-content">
            <!-- INFO PRINCIPAL -->
            <div class="detalle-main">
                <img id="poster" src="" alt="Poster" class="poster">
                
                <div class="info">
                    <h1 id="titulo">Cargando...</h1>
                    <div class="meta">
                        <span id="a√±o"></span>
                        <span id="duracion"></span>
                        <span id="calidad" class="badge"></span>
                        <span id="rating">‚≠ê </span>
                    </div>
                    
                    <p id="descripcion"></p>
                    
                    <div class="details">
                        <p><strong>Director:</strong> <span id="director"></span></p>
                        <p><strong>Actores:</strong> <span id="actores"></span></p>
                        <p><strong>G√©neros:</strong> <span id="generos"></span></p>
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-primary btn-large" onclick="reproducir()">
                            ‚ñ∂ Reproducir
                        </button>
                        <button class="btn btn-secondary" onclick="verTrailer()">
                            üé¨ Trailer
                        </button>
                    </div>
                </div>
            </div>

            <!-- SERVIDORES -->
            <div class="servidores-section">
                <h3>Servidores Disponibles</h3>
                <div class="servidores-grid" id="servidoresGrid">
                    <div class="loading">Cargando servidores...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <p>&copy; 2025 MiStreaming. Todos los derechos reservados.</p>
    </footer>

    <script src="js/app.js"></script>
    <script>
        let peliculaActual = null;

        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            
            if (id) {
                cargarPelicula(id);
            } else {
                window.location.href = '/peliculas.html';
            }
        });

        async function cargarPelicula(id) {
            try {
                const response = await fetch(`/api/pelicula/${id}`);
                peliculaActual = await response.json();
                
                mostrarDetalle(peliculaActual);
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar la pel√≠cula');
            }
        }

        function mostrarDetalle(pelicula) {
            document.title = `${pelicula.titulo} - MiStreaming`;
            document.getElementById('titulo').textContent = pelicula.titulo;
            document.getElementById('poster').src = pelicula.imagen;
            document.getElementById('backdrop').style.backgroundImage = 
                `url(${pelicula.imagen})`;
            document.getElementById('descripcion').textContent = 
                pelicula.descripcion || 'Sin descripci√≥n disponible';
            document.getElementById('a√±o').textContent = pelicula.a√±o || '';
            document.getElementById('duracion').textContent = pelicula.duracion || '';
            document.getElementById('calidad').textContent = pelicula.calidad || '';
            document.getElementById('rating').textContent = 
                `‚≠ê ${pelicula.rating || 'N/A'}`;
            document.getElementById('director').textContent = 
                (pelicula.director || []).join(', ') || 'No disponible';
            document.getElementById('actores').textContent = 
                (pelicula.actores || []).slice(0, 5).join(', ') || 'No disponible';
            document.getElementById('generos').textContent = 
                (pelicula.generos || []).join(', ') || 'No disponible';
            
            // Mostrar servidores
            const servidoresGrid = document.getElementById('servidoresGrid');
            if (pelicula.servidores && pelicula.servidores.length > 0) {
                servidoresGrid.innerHTML = '';
                pelicula.servidores.forEach((servidor, index) => {
                    servidoresGrid.innerHTML += `
                        <div class="servidor-card" onclick="reproducirServidor(${index})">
                            <div class="servidor-nombre">${servidor.nombre}</div>
                            <div class="servidor-desc">${servidor.descripcion}</div>
                        </div>
                    `;
                });
            } else {
                servidoresGrid.innerHTML = '<p>No hay servidores disponibles</p>';
            }
        }

        function reproducir() {
            if (peliculaActual && peliculaActual.servidores && peliculaActual.servidores.length > 0) {
                reproducirServidor(0);
            }
        }

        function reproducirServidor(index) {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            window.location.href = `/reproductor.html?tipo=pelicula&id=${id}&servidor=${index}`;
        }

        function verTrailer() {
            if (peliculaActual && peliculaActual.trailer) {
                window.open(peliculaActual.trailer, '_blank');
            } else {
                alert('Trailer no disponible');
            }
        }
    </script>
</body>
</html>